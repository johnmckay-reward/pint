<!-- 
  Pint? App: Pint Details Page
  Description: Displays the details of an active pint session for users who might want to join.
-->
<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ pintSession?.pubName }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- The Google Map takes up the top half of the screen -->
  <div class="map-container" *ngIf="pintSession && getMapCenter()">
    <google-map 
      [center]="getMapCenter()!" 
      [zoom]="16" 
      width="100%" 
      height="100%">
      
      <!-- Marker for the pub -->
      <map-marker 
        [position]="getMapCenter()!"
        [title]="pintSession.pubName">
      </map-marker>

    </google-map>
  </div>

  <!-- Details Section -->
  <div class="details-container ion-padding" *ngIf="pintSession">
    <ion-card class="details-card">
      <ion-item lines="none" class="initiator-item" button (click)="viewProfile(pintSession.initiator.id)">
        <ion-avatar slot="start" class="initiator-avatar">
          <img [src]="pintSession.initiator.profilePictureUrl || 'https://placehold.co/80x80/4a2c2a/f4f1de?text=' + (pintSession.initiator.displayName.charAt(0).toUpperCase())" />
        </ion-avatar>
        <ion-label>
          <h2>{{ pintSession.initiator.displayName }} started a pint!</h2>
          <p>ETA: {{ pintSession.eta }}</p>
        </ion-label>
      </ion-item>
      
      <ion-card-content>
        <!-- Who's Going Section -->
        <div class="whos-going">
          <h3>Who's Going?</h3>
          <div class="attendee-avatars">
            <ion-avatar *ngFor="let attendee of pintSession.attendees?.slice(0, 4)" class="attendee-avatar">
              <img [src]="attendee.profilePictureUrl || 'https://placehold.co/80x80/4a2c2a/f4f1de?text=' + (attendee.displayName.charAt(0).toUpperCase())" />
            </ion-avatar>
            <div class="attendee-count" *ngIf="pintSession.attendees && pintSession.attendees.length > 4">
              +{{ pintSession.attendees.length - 4 }}
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

</ion-content>

<ion-footer class="ion-no-border">
  <ion-toolbar>
    <ion-button expand="block" size="large" class="join-button" (click)="joinPint()">
      I'm In!
      <ion-icon slot="end" name="beer-outline"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-footer>
