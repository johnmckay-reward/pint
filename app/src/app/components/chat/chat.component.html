<div class="chat-container">
  <!-- Chat Header -->
  <div class="chat-header">
    <h3>Session Chat</h3>
    <ion-badge [color]="isConnected ? 'success' : 'danger'">
      {{ isConnected ? 'Connected' : 'Disconnected' }}
    </ion-badge>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading chat...</p>
  </div>

  <!-- Messages Container -->
  <div class="messages-container" #messagesContainer *ngIf="!isLoading">
    <div class="message-wrapper" *ngFor="let message of messages" 
         [ngClass]="{'own-message': isOwnMessage(message), 'other-message': !isOwnMessage(message)}">
      
      <!-- Other User's Message -->
      <div class="message" *ngIf="!isOwnMessage(message)">
        <ion-avatar class="message-avatar">
          <img [src]="message.sender.profilePictureUrl || 'https://placehold.co/40x40/4a2c2a/f4f1de?text=' + (message.sender.displayName.charAt(0).toUpperCase())" />
        </ion-avatar>
        <div class="message-content">
          <div class="message-header">
            <span class="sender-name">{{ message.sender.displayName }}</span>
            <span class="message-time">{{ getMessageTime(message) }}</span>
          </div>
          <div class="message-text">{{ message.content }}</div>
        </div>
      </div>

      <!-- Own Message -->
      <div class="message own" *ngIf="isOwnMessage(message)">
        <div class="message-content">
          <div class="message-header">
            <span class="message-time">{{ getMessageTime(message) }}</span>
            <span class="sender-name">You</span>
          </div>
          <div class="message-text">{{ message.content }}</div>
        </div>
        <ion-avatar class="message-avatar">
          <img [src]="message.sender.profilePictureUrl || 'https://placehold.co/40x40/4a2c2a/f4f1de?text=' + (message.sender.displayName.charAt(0).toUpperCase())" />
        </ion-avatar>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="messages.length === 0">
      <ion-icon name="chatbubbles-outline" size="large"></ion-icon>
      <p>No messages yet. Start the conversation!</p>
    </div>
  </div>

  <!-- Message Input -->
  <div class="message-input-container" *ngIf="!isLoading">
    <ion-item lines="none" class="message-input-item">
      <ion-textarea 
        [(ngModel)]="newMessage"
        placeholder="Type a message..."
        rows="1"
        auto-grow="true"
        maxlength="1000"
        (keydown)="onKeyPress($event)"
        [disabled]="!isConnected">
      </ion-textarea>
      <ion-button 
        slot="end" 
        fill="clear" 
        size="large"
        (click)="sendMessage()"
        [disabled]="!newMessage.trim() || !isConnected">
        <ion-icon name="send" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-item>
  </div>
</div>
